/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={6434:(e,t,r)=>{"use strict";e=r.nmd(e);const a=(e=0)=>t=>`[${38+e};5;${t}m`,n=(e=0)=>(t,r,a)=>`[${38+e};2;${t};${r};${a}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[r,a]of Object.entries(t)){for(const[r,n]of Object.entries(a))t[r]={open:`[${n[0]}m`,close:`[${n[1]}m`},a[r]=t[r],e.set(n[0],n[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=a(),t.color.ansi16m=n(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=n(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map((e=>e+e)).join(""));const a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),r=t[0],a=t[1];return 3*(r+a)/4-a},t.toByteArray=function(e){var t,r,i=o(e),s=i[0],l=i[1],c=new n(function(e,t,r){return 3*(t+r)/4-r}(0,s,l)),u=0,d=l>0?s-4:s;for(r=0;r<d;r+=4)t=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===l&&(t=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===l&&(t=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,a=e.length,n=a%3,i=[],s=16383,o=0,c=a-n;o<c;o+=s)i.push(l(e,o,o+s>c?c:o+s));return 1===n?(t=e[a-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===n&&(t=(e[a-2]<<8)+e[a-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],a=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)r[s]=i[s],a[i.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,a){for(var n,i,s=[],o=t;o<a;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(r[(i=n)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},3204:e=>{"use strict";const t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,a=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,s=new RegExp("^"+i.source),o=new RegExp(i.source+n.source,"gu"),l=new RegExp("\\d+"+n.source,"gu"),c=(e,n)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(n={pascalCase:!1,preserveConsecutiveUppercase:!1,...n},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const i=!1===n.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(n.locale),c=!1===n.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(n.locale);return 1===e.length?n.pascalCase?c(e):i(e):(e!==i(e)&&(e=((e,a,n)=>{let i=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];i&&t.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),i=!1,o=s,s=!0,l++):s&&o&&r.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,i=!0):(i=a(c)===c&&n(c)!==c,o=s,s=n(c)===c&&a(c)!==c)}return e})(e,i,c)),e=e.replace(s,""),e=n.preserveConsecutiveUppercase?((e,t)=>(a.lastIndex=0,e.replace(a,(e=>t(e)))))(e,i):i(e),n.pascalCase&&(e=c(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,((e,r)=>t(r))).replace(l,(e=>t(e)))))(e,c))};e.exports=c,e.exports.default=c},2466:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},6729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function a(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,a,i,s){if("function"!=typeof a)throw new TypeError("The listener must be a function");var o=new n(a,i||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function o(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,a,n=[];if(0===this._eventsCount)return n;for(a in e=this._events)t.call(e,a)&&n.push(r?a.slice(1):a);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=r?r+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var n=0,i=a.length,s=new Array(i);n<i;n++)s[n]=a[n].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,a=this._events[t];return a?a.fn?1:a.length:0},o.prototype.emit=function(e,t,a,n,i,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,a),!0;case 4:return u.fn.call(u.context,t,a,n),!0;case 5:return u.fn.call(u.context,t,a,n,i),!0;case 6:return u.fn.call(u.context,t,a,n,i,s),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,a);break;case 4:u[c].fn.call(u[c].context,t,a,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,a,n){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||n&&!o.once||a&&o.context!==a||s(this,i);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||n&&!o[l].once||a&&o[l].context!==a)&&c.push(o[l]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new a,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},7345:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},5860:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(6729),n=r(8147),i=r(6506),s=()=>{},o=new n.TimeoutError;t.default=class extends a{constructor(e){var t,r,a,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(n=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==n?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,a)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)}));r(await i)}catch(e){a(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},7489:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let a=0,n=e.length;for(;n>0;){const i=n/2|0;let s=a+i;r(e[s],t)<=0?(a=++s,n-=i+1):n=i}return a}},6506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(7489);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const n=a.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(n,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},2693:(e,t,r)=>{"use strict";const a=r(9353),n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class i extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const s=(e,t)=>new Promise(((r,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=a.operation(t);o.attempt((async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error))return void s(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof i)o.stop(),s(e.originalError);else if(e instanceof TypeError&&(l=e.message,!n.includes(l)))o.stop(),s(e);else{((e,t,r)=>{const a=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=a})(e,a,t);try{await t.onFailedAttempt(e)}catch(e){return void s(e)}o.retry(e)||s(o.mainError())}}var l}))}));e.exports=s,e.exports.default=s,e.exports.AbortError=i},8147:(e,t,r)=>{"use strict";const a=r(7345);class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}const i=(e,t,r)=>new Promise(((i,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void i(e);const o=setTimeout((()=>{if("function"==typeof r){try{i(r())}catch(e){s(e)}return}const a=r instanceof Error?r:new n("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(a)}),t);a(e.then(i,s),(()=>{clearTimeout(o)}))}));e.exports=i,e.exports.default=i,e.exports.TimeoutError=n},9353:(e,t,r)=>{e.exports=r(1846)},1846:(e,t,r)=>{var a=r(1960);t.operation=function(e){var r=t.timeouts(e);return new a(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort((function(e,t){return e-t})),a},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,a=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(a,t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var n in a=[],e)"function"==typeof e[n]&&a.push(n);for(var i=0;i<a.length;i++){var s=a[i],o=e[s];e[s]=function(a){var n=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))})),n.attempt((function(){a.apply(e,i)}))}.bind(e,o),e[s].options=r}}},1960:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout((function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout((function(){a._operationTimeoutCb(a._attempts)}),a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)}),r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}},7429:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return l.default}});var a=h(r(3990)),n=h(r(8237)),i=h(r(5355)),s=h(r(3764)),o=h(r(6314)),l=h(r(8464)),c=h(r(6435)),u=h(r(4008)),d=h(r(8222));function h(e){return e&&e.__esModule?e:{default:e}}},4163:(e,t)=>{"use strict";function r(e){return 14+(e+64>>>9<<4)+1}function a(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,r,n,i,s){return a((o=a(a(t,e),a(n,s)))<<(l=i)|o>>>32-l,r);var o,l}function i(e,t,r,a,i,s,o){return n(t&r|~t&a,e,t,i,s,o)}function s(e,t,r,a,i,s,o){return n(t&a|r&~a,e,t,i,s,o)}function o(e,t,r,a,i,s,o){return n(t^r^a,e,t,i,s,o)}function l(e,t,r,a,i,s,o){return n(r^(t|~a),e,t,i,s,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){const t=[],r=32*e.length,a="0123456789abcdef";for(let n=0;n<r;n+=8){const r=e[n>>5]>>>n%32&255,i=parseInt(a.charAt(r>>>4&15)+a.charAt(15&r),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[r(t)-1]=t;let n=1732584193,c=-271733879,u=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){const r=n,h=c,p=u,f=d;n=i(n,c,u,d,e[t],7,-680876936),d=i(d,n,c,u,e[t+1],12,-389564586),u=i(u,d,n,c,e[t+2],17,606105819),c=i(c,u,d,n,e[t+3],22,-1044525330),n=i(n,c,u,d,e[t+4],7,-176418897),d=i(d,n,c,u,e[t+5],12,1200080426),u=i(u,d,n,c,e[t+6],17,-1473231341),c=i(c,u,d,n,e[t+7],22,-45705983),n=i(n,c,u,d,e[t+8],7,1770035416),d=i(d,n,c,u,e[t+9],12,-1958414417),u=i(u,d,n,c,e[t+10],17,-42063),c=i(c,u,d,n,e[t+11],22,-1990404162),n=i(n,c,u,d,e[t+12],7,1804603682),d=i(d,n,c,u,e[t+13],12,-40341101),u=i(u,d,n,c,e[t+14],17,-1502002290),c=i(c,u,d,n,e[t+15],22,1236535329),n=s(n,c,u,d,e[t+1],5,-165796510),d=s(d,n,c,u,e[t+6],9,-1069501632),u=s(u,d,n,c,e[t+11],14,643717713),c=s(c,u,d,n,e[t],20,-373897302),n=s(n,c,u,d,e[t+5],5,-701558691),d=s(d,n,c,u,e[t+10],9,38016083),u=s(u,d,n,c,e[t+15],14,-660478335),c=s(c,u,d,n,e[t+4],20,-405537848),n=s(n,c,u,d,e[t+9],5,568446438),d=s(d,n,c,u,e[t+14],9,-1019803690),u=s(u,d,n,c,e[t+3],14,-187363961),c=s(c,u,d,n,e[t+8],20,1163531501),n=s(n,c,u,d,e[t+13],5,-1444681467),d=s(d,n,c,u,e[t+2],9,-51403784),u=s(u,d,n,c,e[t+7],14,1735328473),c=s(c,u,d,n,e[t+12],20,-1926607734),n=o(n,c,u,d,e[t+5],4,-378558),d=o(d,n,c,u,e[t+8],11,-2022574463),u=o(u,d,n,c,e[t+11],16,1839030562),c=o(c,u,d,n,e[t+14],23,-35309556),n=o(n,c,u,d,e[t+1],4,-1530992060),d=o(d,n,c,u,e[t+4],11,1272893353),u=o(u,d,n,c,e[t+7],16,-155497632),c=o(c,u,d,n,e[t+10],23,-1094730640),n=o(n,c,u,d,e[t+13],4,681279174),d=o(d,n,c,u,e[t],11,-358537222),u=o(u,d,n,c,e[t+3],16,-722521979),c=o(c,u,d,n,e[t+6],23,76029189),n=o(n,c,u,d,e[t+9],4,-640364487),d=o(d,n,c,u,e[t+12],11,-421815835),u=o(u,d,n,c,e[t+15],16,530742520),c=o(c,u,d,n,e[t+2],23,-995338651),n=l(n,c,u,d,e[t],6,-198630844),d=l(d,n,c,u,e[t+7],10,1126891415),u=l(u,d,n,c,e[t+14],15,-1416354905),c=l(c,u,d,n,e[t+5],21,-57434055),n=l(n,c,u,d,e[t+12],6,1700485571),d=l(d,n,c,u,e[t+3],10,-1894986606),u=l(u,d,n,c,e[t+10],15,-1051523),c=l(c,u,d,n,e[t+1],21,-2054922799),n=l(n,c,u,d,e[t+8],6,1873313359),d=l(d,n,c,u,e[t+15],10,-30611744),u=l(u,d,n,c,e[t+6],15,-1560198380),c=l(c,u,d,n,e[t+13],21,1309151649),n=l(n,c,u,d,e[t+4],6,-145523070),d=l(d,n,c,u,e[t+11],10,-1120210379),u=l(u,d,n,c,e[t+2],15,718787259),c=l(c,u,d,n,e[t+9],21,-343485551),n=a(n,r),c=a(c,h),u=a(u,p),d=a(d,f)}return[n,c,u,d]}(function(e){if(0===e.length)return[];const t=8*e.length,a=new Uint32Array(r(t));for(let r=0;r<t;r+=8)a[r>>5]|=(255&e[r/8])<<r%32;return a}(e),8*e.length))}},4790:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=r},6314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},8222:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,n=(a=r(6435))&&a.__esModule?a:{default:a};t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");let t;const r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},58:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},3319:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(a)};const a=new Uint8Array(16)},3757:(e,t)=>{"use strict";function r(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:case 3:return t^r^a;case 2:return t&r^t&a^r&a}}function a(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const i=e.length/4+2,s=Math.ceil(i/16),o=new Array(s);for(let t=0;t<s;++t){const r=new Uint32Array(16);for(let a=0;a<16;++a)r[a]=e[64*t+4*a]<<24|e[64*t+4*a+1]<<16|e[64*t+4*a+2]<<8|e[64*t+4*a+3];o[t]=r}o[s-1][14]=8*(e.length-1)/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<s;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=o[e][t];for(let e=16;e<80;++e)i[e]=a(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let s=n[0],l=n[1],c=n[2],u=n[3],d=n[4];for(let e=0;e<80;++e){const n=Math.floor(e/20),o=a(s,5)+r(n,l,c,u)+d+t[n]+i[e]>>>0;d=u,u=c,c=a(l,30)>>>0,l=s,s=o}n[0]=n[0]+s>>>0,n[1]=n[1]+l>>>0,n[2]=n[2]+c>>>0,n[3]=n[3]+u>>>0,n[4]=n[4]+d>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}},4008:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=s;var a,n=(a=r(6435))&&a.__esModule?a:{default:a};const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function s(e,t=0){return i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]}t.default=function(e,t=0){const r=s(e,t);if(!(0,n.default)(r))throw TypeError("Stringified UUID is invalid");return r}},3990:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,n=(a=r(3319))&&a.__esModule?a:{default:a},i=r(4008);let s,o,l=0,c=0;t.default=function(e,t,r){let a=t&&r||0;const u=t||new Array(16);let d=(e=e||{}).node||s,h=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==h){const t=e.random||(e.rng||n.default)();null==d&&(d=s=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==h&&(h=o=16383&(t[6]<<8|t[7]))}let p=void 0!==e.msecs?e.msecs:Date.now(),f=void 0!==e.nsecs?e.nsecs:c+1;const m=p-l+(f-c)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||p>l)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=p,c=f,o=h,p+=122192928e5;const g=(1e4*(268435455&p)+f)%4294967296;u[a++]=g>>>24&255,u[a++]=g>>>16&255,u[a++]=g>>>8&255,u[a++]=255&g;const b=p/4294967296*1e4&268435455;u[a++]=b>>>8&255,u[a++]=255&b,u[a++]=b>>>24&15|16,u[a++]=b>>>16&255,u[a++]=h>>>8|128,u[a++]=255&h;for(let e=0;e<6;++e)u[a+e]=d[e];return t||(0,i.unsafeStringify)(u)}},8237:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(7925)),n=i(r(4163));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,a.default)("v3",48,n.default);t.default=s},7925:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,r){function a(e,a,s,o){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof a&&(a=(0,i.default)(a)),16!==(null===(l=a)||void 0===l?void 0:l.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+e.length);if(c.set(a),c.set(e,a.length),c=r(c),c[6]=15&c[6]|t,c[8]=63&c[8]|128,s){o=o||0;for(let e=0;e<16;++e)s[o+e]=c[e];return s}return(0,n.unsafeStringify)(c)}try{a.name=e}catch(e){}return a.DNS=s,a.URL=o,a};var a,n=r(4008),i=(a=r(8222))&&a.__esModule?a:{default:a};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=s;const o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o},5355:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(r(4790)),n=s(r(3319)),i=r(4008);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,r){if(a.default.randomUUID&&!t&&!e)return a.default.randomUUID();const s=(e=e||{}).random||(e.rng||n.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return(0,i.unsafeStringify)(s)}},3764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(7925)),n=i(r(3757));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,a.default)("v5",80,n.default);t.default=s},6435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,n=(a=r(58))&&a.__esModule?a:{default:a};t.default=function(e){return"string"==typeof e&&n.default.test(e)}},8464:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,n=(a=r(6435))&&a.__esModule?a:{default:a};t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},4951:(e,t,r)=>{e.exports=r(9108)},9108:(e,t,r)=>{"use strict";t.ChatOllama=void 0;const a=r(114),n=r(9693),i=r(3174),s=r(3119);class o extends a.SimpleChatModel{static lc_name(){return"ChatOllama"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama2"}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://localhost:11434"}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16KV",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGqa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model??this.model,this.baseUrl=e.baseUrl?.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl??this.baseUrl,this.embeddingOnly=e.embeddingOnly,this.f16KV=e.f16KV,this.frequencyPenalty=e.frequencyPenalty,this.logitsAll=e.logitsAll,this.lowVram=e.lowVram,this.mainGpu=e.mainGpu,this.mirostat=e.mirostat,this.mirostatEta=e.mirostatEta,this.mirostatTau=e.mirostatTau,this.numBatch=e.numBatch,this.numCtx=e.numCtx,this.numGpu=e.numGpu,this.numGqa=e.numGqa,this.numKeep=e.numKeep,this.numPredict=e.numPredict,this.numThread=e.numThread,this.penalizeNewline=e.penalizeNewline,this.presencePenalty=e.presencePenalty,this.repeatLastN=e.repeatLastN,this.repeatPenalty=e.repeatPenalty,this.ropeFrequencyBase=e.ropeFrequencyBase,this.ropeFrequencyScale=e.ropeFrequencyScale,this.temperature=e.temperature,this.stop=e.stop,this.tfsZ=e.tfsZ,this.topK=e.topK,this.topP=e.topP,this.typicalP=e.typicalP,this.useMLock=e.useMLock,this.useMMap=e.useMMap,this.vocabOnly=e.vocabOnly,this.format=e.format}_llmType(){return"ollama"}invocationParams(e){return{model:this.model,format:this.format,options:{embedding_only:this.embeddingOnly,f16_kv:this.f16KV,frequency_penalty:this.frequencyPenalty,logits_all:this.logitsAll,low_vram:this.lowVram,main_gpu:this.mainGpu,mirostat:this.mirostat,mirostat_eta:this.mirostatEta,mirostat_tau:this.mirostatTau,num_batch:this.numBatch,num_ctx:this.numCtx,num_gpu:this.numGpu,num_gqa:this.numGqa,num_keep:this.numKeep,num_predict:this.numPredict,num_thread:this.numThread,penalize_newline:this.penalizeNewline,presence_penalty:this.presencePenalty,repeat_last_n:this.repeatLastN,repeat_penalty:this.repeatPenalty,rope_frequency_base:this.ropeFrequencyBase,rope_frequency_scale:this.ropeFrequencyScale,temperature:this.temperature,stop:e?.stop??this.stop,tfs_z:this.tfsZ,top_k:this.topK,top_p:this.topP,typical_p:this.typicalP,use_mlock:this.useMLock,use_mmap:this.useMMap,vocab_only:this.vocabOnly}}}_combineLLMOutput(){return{}}async*_streamResponseChunksLegacy(e,t,r){const a=(0,s.createOllamaGenerateStream)(this.baseUrl,{...this.invocationParams(t),prompt:this._formatMessagesAsPrompt(e)},t);for await(const e of a)e.done?yield new i.ChatGenerationChunk({text:"",message:new n.AIMessageChunk({content:""}),generationInfo:{model:e.model,total_duration:e.total_duration,load_duration:e.load_duration,prompt_eval_count:e.prompt_eval_count,prompt_eval_duration:e.prompt_eval_duration,eval_count:e.eval_count,eval_duration:e.eval_duration}}):(yield new i.ChatGenerationChunk({text:e.response,message:new n.AIMessageChunk({content:e.response})}),await(r?.handleLLMNewToken(e.response??"")))}async*_streamResponseChunks(e,t,r){try{const a=await this.caller.call((async()=>(0,s.createOllamaChatStream)(this.baseUrl,{...this.invocationParams(t),messages:this._convertMessagesToOllamaMessages(e)},t)));for await(const e of a)e.done?yield new i.ChatGenerationChunk({text:"",message:new n.AIMessageChunk({content:""}),generationInfo:{model:e.model,total_duration:e.total_duration,load_duration:e.load_duration,prompt_eval_count:e.prompt_eval_count,prompt_eval_duration:e.prompt_eval_duration,eval_count:e.eval_count,eval_duration:e.eval_duration}}):(yield new i.ChatGenerationChunk({text:e.message.content,message:new n.AIMessageChunk({content:e.message.content})}),await(r?.handleLLMNewToken(e.message.content??"")))}catch(a){if(404!==a.response?.status)throw a;console.warn("[WARNING]: It seems you are using a legacy version of Ollama. Please upgrade to a newer version for better chat support."),yield*this._streamResponseChunksLegacy(e,t,r)}}_convertMessagesToOllamaMessages(e){return e.map((e=>{let t;if("human"===e._getType())t="user";else if("ai"===e._getType())t="assistant";else{if("system"!==e._getType())throw new Error(`Unsupported message type for Ollama: ${e._getType()}`);t="system"}let r="";const a=[];if("string"==typeof e.content)r=e.content;else for(const t of e.content)if("text"===t.type)r=`${r}\n${t.text}`;else{if("image_url"!==t.type||"string"!=typeof t.image_url)throw new Error('Unsupported message content type. Must either have type "text" or type "image_url" with a string "image_url" field.');{const e=t.image_url.split(",");a.push(e[1]??e[0])}}return{role:t,content:r,images:a}}))}_formatMessagesAsPrompt(e){return e.map((e=>{let t;return"human"===e._getType()?t=`[INST] ${e.content} [/INST]`:"ai"===e._getType()?t=e.content:"system"===e._getType()?t=`<<SYS>> ${e.content} <</SYS>>`:n.ChatMessage.isInstance(e)?t=`\n\n${e.role[0].toUpperCase()}${e.role.slice(1)}: ${e.content}`:(console.warn(`Unsupported message type passed to Ollama: "${e._getType()}"`),t=""),t})).join("\n")}async _call(e,t,r){const a=[];for await(const n of this._streamResponseChunks(e,t,r))a.push(n.message.content);return a.join("")}}t.ChatOllama=o},3119:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOllamaChatStream=t.createOllamaGenerateStream=void 0;const a=r(2561);async function*n(e,t,r){let n=e;n.startsWith("http://localhost:")&&(n=n.replace("http://localhost:","http://127.0.0.1:"));const i=await fetch(n,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"},signal:r.signal});if(!i.ok){let e;const t=await i.text();try{const r=JSON.parse(t);e=new Error(`Ollama call failed with status code ${i.status}: ${r.error}`)}catch(r){e=new Error(`Ollama call failed with status code ${i.status}: ${t}`)}throw e.response=i,e}if(!i.body)throw new Error("Could not begin Ollama stream. Please check the given URL and try again.");const s=a.IterableReadableStream.fromReadableStream(i.body),o=new TextDecoder;let l="";for await(const e of s){const t=(l+o.decode(e)).split("\n");l=t.pop()||"";for(const e of t)try{yield JSON.parse(e)}catch(t){console.warn(`Received a non-JSON parseable chunk: ${e}`)}}}t.createOllamaGenerateStream=async function*(e,t,r){yield*n(`${e}/api/generate`,t,r)},t.createOllamaChatStream=async function*(e,t,r){yield*n(`${e}/api/chat`,t,r)}},368:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryCache=t.BaseCache=t.serializeGeneration=t.deserializeStoredGeneration=t.getCacheKey=void 0;const a=r(4116),n=r(1165);t.getCacheKey=(...e)=>(0,a.insecureHash)(e.join("_")),t.deserializeStoredGeneration=function(e){return void 0!==e.message?{text:e.text,message:(0,n.mapStoredMessageToChatMessage)(e.message)}:{text:e.text}},t.serializeGeneration=function(e){const t={text:e.text};return void 0!==e.message&&(t.message=e.message.toDict()),t};class i{}t.BaseCache=i;const s=new Map;class o extends i{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,r){return Promise.resolve(this.cache.get((0,t.getCacheKey)(e,r))??null)}async update(e,r,a){this.cache.set((0,t.getCacheKey)(e,r),a)}static global(){return new o(s)}}t.InMemoryCache=o},7986:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCallbackHandler=void 0;const s=i(r(7429)),o=r(2398);class l{}class c extends l{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,o.get_lc_unique_name)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"==typeof process||"true"!==process.env?.LANGCHAIN_CALLBACKS_BACKGROUND}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return o.Serializable.prototype.toJSON.call(this)}toJSONNotImplemented(){return o.Serializable.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends c{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:s.v4()}),Object.assign(this,e)}}}}t.BaseCallbackHandler=c},9028:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.traceAsGroup=t.TraceGroup=t.ensureHandler=t.CallbackManager=t.CallbackManagerForToolRun=t.CallbackManagerForChainRun=t.CallbackManagerForLLMRun=t.CallbackManagerForRetrieverRun=t.BaseCallbackManager=t.parseCallbackConfigArg=void 0;const a=r(7429),n=r(7986),i=r(156),s=r(6614),o=r(1165),l=r(1073),c=r(1744),u=r(1212);t.parseCallbackConfigArg=function(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}};class d{setHandler(e){return this.setHandlers([e])}}t.BaseCallbackManager=d;class h{constructor(e,t,r,a,n,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class p extends h{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForRetrieverRun=p;class f extends h{async handleLLMNewToken(e,t,r,a,n,i){await Promise.all(this.handlers.map((r=>(0,u.consumeCallback)((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}}),r.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForLLMRun=f;class m extends h{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,n){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,r,a,n){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForChainRun=m;class g extends h{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>(0,u.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForToolRun=g;class b extends d{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}async handleLLMStart(e,t,r=void 0,n=void 0,i=void 0,s=void 0,o=void 0,l=void 0){return Promise.all(t.map((async t=>{const r=(0,a.v4)();return await Promise.all(this.handlers.map((a=>(0,u.consumeCallback)((async()=>{if(!a.ignoreLLM)try{await(a.handleLLMStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata,l))}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}}),a.awaitHandlers)))),new f(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,r=void 0,n=void 0,i=void 0,s=void 0,l=void 0,c=void 0){return Promise.all(t.map((async t=>{const r=(0,a.v4)();return await Promise.all(this.handlers.map((a=>(0,u.consumeCallback)((async()=>{if(!a.ignoreLLM)try{if(a.handleChatModelStart)await(a.handleChatModelStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata,c));else if(a.handleLLMStart){const n=(0,o.getBufferString)(t);await(a.handleLLMStart?.(e,[n],r,this._parentRunId,i,this.tags,this.metadata,c))}}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}}),a.awaitHandlers)))),new f(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,r=(0,a.v4)(),n=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((a=>(0,u.consumeCallback)((async()=>{if(!a.ignoreChain)try{await(a.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,n,o))}catch(e){console.error(`Error in handler ${a.constructor.name}, handleChainStart: ${e}`)}}),a.awaitHandlers)))),new m(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,a.v4)(),n=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((a=>(0,u.consumeCallback)((async()=>{if(!a.ignoreAgent)try{await(a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`)}}),a.awaitHandlers)))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,a.v4)(),n=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((a=>(0,u.consumeCallback)((async()=>{if(!a.ignoreRetriever)try{await(a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`)}}),a.awaitHandlers)))),new p(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new b(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);r.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(const a of e)r.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===a.name))||r.addHandler(a,t);return r}static fromHandlers(e){class t extends n.BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,a.v4)()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,n,o,c){let u;(e||t)&&(Array.isArray(e)||!e?(u=new b,u.setHandlers(e?.map(y)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(y):t?.handlers,!1));const d="true"===(0,l.getEnvironmentVariable)("LANGCHAIN_VERBOSE")||c?.verbose,h="true"===(0,l.getEnvironmentVariable)("LANGCHAIN_TRACING_V2"),p=h||((0,l.getEnvironmentVariable)("LANGCHAIN_TRACING")??!1);if(d||p){if(u||(u=new b),d&&!u.handlers.some((e=>e.name===i.ConsoleCallbackHandler.prototype.name))){const e=new i.ConsoleCallbackHandler;u.addHandler(e,!0)}p&&!u.handlers.some((e=>"langchain_tracer"===e.name))&&h&&u.addHandler(await(0,s.getTracingV2CallbackHandler)(),!0)}return(r||a)&&u&&(u.addTags(r??[]),u.addTags(a??[],!1)),(n||o)&&u&&(u.addMetadata(n??{}),u.addMetadata(o??{},!1)),u}}function y(e){return"name"in e?e:n.BaseCallbackHandler.fromMethods(e)}t.CallbackManager=b,t.ensureHandler=y;class _{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t,r){const a=new c.LangChainTracer(r),n=await b.configure([a]),i=await(n?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{}));if(!i)throw new Error("Failed to create run group callback manager.");return i}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}t.TraceGroup=_,t.traceAsGroup=async function(e,t,...r){const a=new _(e.name,e),n=await a.start({...r});try{const e=await t(n,...r);return await a.end((i=e,"output",i&&!Array.isArray(i)&&"object"==typeof i?i:{output:i})),e}catch(e){throw await a.error(e),e}var i}},1212:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.awaitAllCallbacks=t.consumeCallback=void 0;const n=a(r(5860));let i;t.consumeCallback=async function(e,t){!0===t?await e():(void 0===i&&(i=new("default"in n.default?n.default.default:n.default)({autoStart:!0,concurrency:1})),i.add(e))},t.awaitAllCallbacks=function(){return void 0!==i?i.onIdle():Promise.resolve()}},1658:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLanguageModel=t.BaseLangChain=t.calculateMaxTokens=t.getModelContextSize=t.getEmbeddingContextSize=t.getModelNameForTiktoken=void 0;const a=r(368),n=r(8358),i=r(1165),s=r(8541),o=r(3022),l=r(9803);t.getModelNameForTiktoken=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e,t.getEmbeddingContextSize=e=>"text-embedding-ada-002"===e?8191:2046,t.getModelContextSize=e=>{switch((0,t.getModelNameForTiktoken)(e)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":default:return 4097;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":return 8e3}},t.calculateMaxTokens=async({prompt:e,modelName:r})=>{let a;try{a=(await(0,o.encodingForModel)((0,t.getModelNameForTiktoken)(r))).encode(e).length}catch(t){console.warn("Failed to calculate number of tokens, falling back to approximate count"),a=Math.ceil(e.length/4)}return(0,t.getModelContextSize)(r)-a};class c extends l.Runnable{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}t.BaseLangChain=c,t.BaseLanguageModel=class extends c{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=a.InMemoryCache.global():this.cache=void 0,this.caller=new s.AsyncCaller(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let r=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await(0,o.encodingForModel)("modelName"in this?(0,t.getModelNameForTiktoken)(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{r=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return r}static _convertInputToPromptValue(e){return"string"==typeof e?new n.StringPromptValue(e):Array.isArray(e)?new n.ChatPromptValue(e.map(i.coerceMessageLikeToMessage)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){const t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()};return Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}},6709:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleChatModel=t.BaseChatModel=t.createChatMessageChunkEncoderStream=void 0;const a=r(1165),n=r(2861),i=r(1658),s=r(9028);t.createChatMessageChunkEncoderStream=function(){const e=new TextEncoder;return new TransformStream({transform(t,r){r.enqueue(e.encode("string"==typeof t.content?t.content:JSON.stringify(t.content)))}})};class o extends i.BaseLanguageModel{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r?.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=o._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===o.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=o._convertInputToPromptValue(e).toChatMessages(),[a,n]=this._separateRunnableConfigFromCallOptions(t),i=await s.CallbackManager.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l={options:n,invocation_params:this?.invocationParams(n),batch_size:1},c=await(i?.handleChatModelStart(this.toJSON(),[r],void 0,void 0,l,void 0,void 0,a.runName));let u;try{for await(const e of this._streamResponseChunks(r,n,c?.[0]))yield e.message,u=u?u.concat(e):e}catch(e){throw await Promise.all((c??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((c??[]).map((e=>e?.handleLLMEnd({generations:[[u]]}))))}}async _generateUncached(e,t,r){const i=e.map((e=>e.map(a.coerceMessageLikeToMessage))),o=await s.CallbackManager.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),l={options:t,invocation_params:this?.invocationParams(t),batch_size:1},c=await(o?.handleChatModelStart(this.toJSON(),i,void 0,void 0,l,void 0,void 0,r.runName)),u=await Promise.allSettled(i.map(((e,r)=>this._generate(e,{...t,promptIndex:r},c?.[r])))),d=[],h=[];await Promise.all(u.map((async(e,t)=>{if("fulfilled"===e.status){const r=e.value;return d[t]=r.generations,h[t]=r.llmOutput,c?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}return await(c?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const p={generations:d,llmOutput:h.length?this._combineLLMOutput?.(...h):void 0};return Object.defineProperty(p,n.RUN_KEY,{value:c?{runIds:c?.map((e=>e.runId))}:void 0,configurable:!0}),p}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:l}){const c=e.map((e=>e.map(a.coerceMessageLikeToMessage))),u=await s.CallbackManager.configure(l.callbacks,this.callbacks,l.tags,this.tags,l.metadata,this.metadata,{verbose:this.verbose}),d={options:i,invocation_params:this?.invocationParams(i),batch_size:1,cached:!0},h=await(u?.handleChatModelStart(this.toJSON(),c,void 0,void 0,d,void 0,void 0,l.runName)),p=[],f=(await Promise.allSettled(c.map((async(e,a)=>{const n=o._convertInputToPromptValue(e).toString(),i=await t.lookup(n,r);return null==i&&p.push(a),i})))).map(((e,t)=>({result:e,runManager:h?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),m=[];await Promise.all(f.map((async({result:e,runManager:t},r)=>{if("fulfilled"===e.status){const a=e.value;return m[r]=a,a.length&&await(t?.handleLLMNewToken(a[0].text)),t?.handleLLMEnd({generations:[a]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const g={generations:m,missingPromptIndices:p};return Object.defineProperty(g,n.RUN_KEY,{value:h?{runIds:h?.map((e=>e.runId))}:void 0,configurable:!0}),g}async generate(e,t,r){let n;n=Array.isArray(t)?{stop:t}:t;const i=e.map((e=>e.map(a.coerceMessageLikeToMessage))),[s,l]=this._separateRunnableConfigFromCallOptions(n);if(s.callbacks=s.callbacks??r,!this.cache)return this._generateUncached(i,l,s);const{cache:c}=this,u=this._getSerializedCacheKeyParametersForCall(l),{generations:d,missingPromptIndices:h}=await this._generateCached({messages:i,cache:c,llmStringKey:u,parsedOptions:l,handledOptions:s});let p={};if(h.length>0){const e=await this._generateUncached(h.map((e=>i[e])),l,s);await Promise.all(e.generations.map((async(e,t)=>{const r=h[t];d[r]=e;const a=o._convertInputToPromptValue(i[r]).toString();return c.update(a,u,e)}))),p=e.llmOutput??{}}return{generations:d,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const a=e.map((e=>e.toChatMessages()));return this.generate(a,t,r)}async call(e,t,r){return(await this.generate([e.map(a.coerceMessageLikeToMessage)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const n=new a.HumanMessage(e),i=await this.call([n],t,r);if("string"!=typeof i.content)throw new Error("Cannot use predict when output is not a string.");return i.content}}t.BaseChatModel=o,t.SimpleChatModel=class extends o{async _generate(e,t,r){const n=await this._call(e,t,r),i=new a.AIMessage(n);if("string"!=typeof i.content)throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:i.content,message:i}]}}}},4036:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mapKeys=t.keyFromJson=t.keyToJson=void 0;const n=a(r(2466)),i=a(r(3204));t.keyToJson=function(e,t){return t?.[e]||(0,n.default)(e)},t.keyFromJson=function(e,t){return t?.[e]||(0,i.default)(e)},t.mapKeys=function(e,t,r){const a={};for(const n in e)Object.hasOwn(e,n)&&(a[t(n,r)]=e[n]);return a}},2398:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Serializable=t.get_lc_unique_name=void 0;const a=r(4036);function n(e){return Array.isArray(e)?[...e]:{...e}}function i(e,t){const r=n(e);for(const[e,a]of Object.entries(t)){const[t,...i]=e.split(".").reverse();let s=r;for(const e of i.reverse()){if(void 0===s[e])break;s[e]=n(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[a]})}return r}function s(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}t.get_lc_unique_name=s;class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,a=r;const[n,...i]=e.split(".").reverse();for(const e of i.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}n in t&&void 0!==t[n]&&(a[n]=a[n]||t[n])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:(0,a.mapKeys)(Object.keys(t).length?i(r,t):r,a.keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}t.Serializable=o},1165:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapChatMessagesToStoredMessages=t.mapStoredMessagesToChatMessages=t.mapStoredMessageToChatMessage=t.getBufferString=t.ChatMessageChunk=t.coerceMessageLikeToMessage=t.isBaseMessageChunk=t.isBaseMessage=t.ChatMessage=t.ToolMessageChunk=t.ToolMessage=t.FunctionMessageChunk=t.FunctionMessage=t.SystemMessageChunk=t.SystemMessage=t.AIMessageChunk=t.AIMessage=t.HumanMessageChunk=t.HumanMessage=t.BaseMessageChunk=t.BaseMessage=void 0;const a=r(2398);function n(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class i extends a.Serializable{get lc_aliases(){return{additional_kwargs:"additional_kwargs"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){const e=this._getType();if("human"===e)return new c({...this});if("ai"===e)return new d({...this});if("system"===e)return new p({...this});if("function"===e)return new m({...this});if(y.isInstance(this))return new v({...this});throw new Error("Unknown message type.")}}function s(e){return Array.isArray(e)&&e.every((e=>"number"==typeof e.index))}t.BaseMessage=i;class o extends i{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[e,a]of Object.entries(t))if(void 0===r[e])r[e]=a;else{if(typeof r[e]!=typeof a)throw new Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof r[e])r[e]=r[e]+a;else if(Array.isArray(r[e])||"object"!=typeof r[e]){if("tool_calls"!==e||!s(r[e])||!s(a))throw new Error(`additional_kwargs[${e}] already exists in this message chunk.`);for(const t of a)void 0!==r[e]?.[t.index]?r[e]=r[e]?.map(((e,r)=>r!==t.index?e:{...e,...t,function:{name:t.function.name??e.function.name,arguments:(e.function.arguments??"")+(t.function.arguments??"")}})):r[e][t.index]=t}else r[e]=this._mergeAdditionalKwargs(r[e],a)}return r}}t.BaseMessageChunk=o;class l extends i{static lc_name(){return"HumanMessage"}_getType(){return"human"}}t.HumanMessage=l;class c extends o{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new c({content:n(this.content,e.content),additional_kwargs:c._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}t.HumanMessageChunk=c;class u extends i{static lc_name(){return"AIMessage"}_getType(){return"ai"}}t.AIMessage=u;class d extends o{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new d({content:n(this.content,e.content),additional_kwargs:d._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}t.AIMessageChunk=d;class h extends i{static lc_name(){return"SystemMessage"}_getType(){return"system"}}t.SystemMessage=h;class p extends o{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new p({content:n(this.content,e.content),additional_kwargs:p._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}t.SystemMessageChunk=p;class f extends i{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}t.FunctionMessage=f;class m extends o{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new m({content:n(this.content,e.content),additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}t.FunctionMessageChunk=m;class g extends i{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}_getType(){return"tool"}}t.ToolMessage=g;class b extends o{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new b({content:n(this.content,e.content),additional_kwargs:b._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),tool_call_id:this.tool_call_id})}}t.ToolMessageChunk=b;class y extends i{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function _(e){return"function"==typeof e?._getType}t.ChatMessage=y,t.isBaseMessage=_,t.isBaseMessageChunk=function(e){return _(e)&&"function"==typeof e.concat},t.coerceMessageLikeToMessage=function(e){if("string"==typeof e)return new l(e);if(_(e))return e;const[t,r]=e;if("human"===t||"user"===t)return new l({content:r});if("ai"===t||"assistant"===t)return new u({content:r});if("system"===t)return new h({content:r});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")};class v extends o{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new v({content:n(this.content,e.content),additional_kwargs:v._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}function w(e){const t=function(e){if(void 0!==e.data)return e;{const t=e;return{type:t.type,data:{content:t.text,role:t.role,name:void 0,tool_call_id:void 0}}}}(e);switch(t.type){case"human":return new l(t.data);case"ai":return new u(t.data);case"system":return new h(t.data);case"function":if(void 0===t.data.name)throw new Error("Name must be defined for function messages");return new f(t.data);case"tool":if(void 0===t.data.tool_call_id)throw new Error("Tool call ID must be defined for tool messages");return new g(t.data);case"chat":if(void 0===t.data.role)throw new Error("Role must be defined for chat messages");return new y(t.data);default:throw new Error(`Got unexpected type: ${t.type}`)}}t.ChatMessageChunk=v,t.getBufferString=function(e,t="Human",r="AI"){const a=[];for(const n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("function"===n._getType())e="Function";else if("tool"===n._getType())e="Tool";else{if("generic"!==n._getType())throw new Error(`Got unsupported message type: ${n._getType()}`);e=n.role}const i=n.name?`${n.name}, `:"";a.push(`${e}: ${i}${n.content}`)}return a.join("\n")},t.mapStoredMessageToChatMessage=w,t.mapStoredMessagesToChatMessages=function(e){return e.map(w)},t.mapChatMessagesToStoredMessages=function(e){return e.map((e=>e.toDict()))}},2861:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatGenerationChunk=t.GenerationChunk=t.RUN_KEY=void 0,t.RUN_KEY="__run";class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}t.GenerationChunk=r;class a extends r{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new a({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}t.ChatGenerationChunk=a},8358:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPromptValue=t.StringPromptValue=t.BasePromptValue=void 0;const a=r(2398),n=r(1165);class i extends a.Serializable{}t.BasePromptValue=i,t.StringPromptValue=class extends i{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.HumanMessage(this.value)]}},t.ChatPromptValue=class extends i{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,n.getBufferString)(this.messages)}toChatMessages(){return this.messages}}},9803:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RunnablePick=t.RunnableAssign=t._coerceToRunnable=t.RunnableWithFallbacks=t.RunnableParallel=t.RunnableLambda=t.RunnableMap=t.RunnableSequence=t.RunnableRetry=t.RunnableEach=t.RunnableBinding=t.Runnable=t._coerceToDict=void 0;const n=a(r(2693)),i=r(9028),s=r(1242),o=r(2398),l=r(8197),c=r(3014),u=r(8541),d=r(4313);function h(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}t._coerceToDict=h;class p extends o.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new f({bound:this,kwargs:e,config:{}})}map(){return new m({bound:this})}withRetry(e){return new g({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new f({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new v({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e.map(c.ensureConfig)}return Array.from({length:t},(()=>(0,c.ensureConfig)(e)))}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),n=a[0]?.maxConcurrency??r?.maxConcurrency,i=new u.AsyncCaller({maxConcurrency:n,onFailedAttempt:e=>{throw e}}),s=e.map(((e,t)=>i.call((async()=>{try{return await this.invoke(e,a[t])}catch(e){if(r?.returnExceptions)return e;throw e}}))));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=new l.AsyncGeneratorWithSetup(this._streamIterator(e,t));return await r.setup,l.IterableReadableStream.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e={}){const t=(0,c.ensureConfig)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency}),r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,[t,r]}async _callWithConfig(e,t,r){const a=(0,c.ensureConfig)(r),n=await(0,c.getCallbackManagerForConfig)(a),i=await(n?.handleChainStart(this.toJSON(),h(t,"input"),void 0,a?.runType,void 0,void 0,a?.runName??this.getName()));let s;try{s=await e.call(this,t,a,i)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(h(s,"output"))),s}async _batchWithConfig(e,t,r,a){const n=this._getOptionsList(r??{},t.length),i=await Promise.all(n.map(c.getCallbackManagerForConfig)),s=await Promise.all(i.map(((e,r)=>e?.handleChainStart(this.toJSON(),h(t[r],"input"),void 0,n[r].runType,void 0,void 0,n[r].runName??this.getName()))));let o;try{o=await e.call(this,t,n,s,a)}catch(e){throw await Promise.all(s.map((t=>t?.handleChainError(e)))),e}return await Promise.all(s.map((e=>e?.handleChainEnd(h(o,"output"))))),o}async*_transformStreamWithConfig(e,t,r){let a,n,i=!0,s=!0;const o=(0,c.ensureConfig)(r),u=await(0,c.getCallbackManagerForConfig)(o);let d;try{const r=await(0,l.pipeGeneratorWithSetup)(t.bind(this),async function*(){for await(const t of e){if(i)if(void 0===a)a=t;else try{a=(0,l.concat)(a,t)}catch{a=void 0,i=!1}yield t}}(),(async()=>u?.handleChainStart(this.toJSON(),{input:""},void 0,o?.runType,void 0,void 0,o?.runName??this.getName())),o);d=r.setup;const c=e=>"log_stream_tracer"===e.name,h=d?.handlers.find(c);let p=r.output;void 0!==h&&void 0!==d&&(p=await h.tapOutputIterable(d.runId,r.output));for await(const e of p)if(yield e,s)if(void 0===n)n=e;else try{n=(0,l.concat)(n,e)}catch{n=void 0,s=!1}}catch(e){throw await(d?.handleChainError(e,void 0,void 0,void 0,{inputs:h(a,"input")})),e}await(d?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:h(a,"input")}))}pipe(e){return new b({first:this,last:w(e)})}pick(e){return this.pipe(new O(e))}assign(e){return this.pipe(new C(new y({steps:e})))}async*transform(e,t){let r;for await(const t of e)r=void 0===r?t:(0,l.concat)(r,t);yield*this._streamIterator(r,t)}async*streamLog(e,t,r){const a=new s.LogStreamCallbackHandler({...r,autoClose:!1}),n=(0,c.ensureConfig)(t),{callbacks:i}=n;if(void 0===i)n.callbacks=[a];else if(Array.isArray(i))n.callbacks=i.concat([a]);else{const e=i.copy();e.inheritableHandlers.push(a),n.callbacks=e}const o=await this.stream(e,n),l=async function(){try{for await(const e of o){const t=new s.RunLogPatch({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await a.writer.write(t)}}finally{await a.writer.close()}}();try{for await(const e of a)yield e}finally{await l}}static isRunnable(e){return!!e&&e.lc_runnable}withListeners({onStart:e,onEnd:t,onError:r}){return new f({bound:this,config:{},configFactories:[a=>({callbacks:[new d.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}t.Runnable=p;class f extends p{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=(0,c.mergeConfigs)(this.config,...e);return(0,c.mergeConfigs)(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(t,this.kwargs))}async batch(e,t,r){const a=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig(e,this.kwargs)))):await this._mergeConfig(t,this.kwargs);return this.bound.batch(e,a,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(t,this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(t,this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(t,this.kwargs))}static isRunnableBinding(e){return e.bound&&p.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new f({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new d.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}t.RunnableBinding=f;class m extends p{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new m({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,(0,c.patchConfig)(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new m({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}t.RunnableEach=m;class g extends f{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const a=e>1?`retry:attempt:${e}`:void 0;return(0,c.patchConfig)(t,{callbacks:r?.getChild(a)})}async _invoke(e,t,r){return(0,n.default)((a=>super.invoke(e,this._patchConfigForRetry(a,t,r))),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){const i={};try{await(0,n.default)((async n=>{const s=e.map(((e,t)=>t)).filter((e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error)),o=s.map((t=>e[t])),l=s.map((e=>this._patchConfigForRetry(n,t?.[e],r?.[e]))),c=await super.batch(o,l,{...a,returnExceptions:!0});let u;for(let e=0;e<c.length;e+=1){const t=c[e],r=s[e];t instanceof Error&&void 0===u&&(u=t),i[r.toString()]=t}if(u)throw u;return c}),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==a?.returnExceptions)throw e}return Object.keys(i).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>i[parseInt(e,10)]))}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}t.RunnableRetry=g;class b extends p{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await(0,c.getCallbackManagerForConfig)(t),a=await(r?.handleChainStart(this.toJSON(),h(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let n,i=e;try{const e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){const n=e[r];i=await n.invoke(i,(0,c.patchConfig)(t,{callbacks:a?.getChild(`seq:step:${r+1}`)}))}n=await this.last.invoke(i,(0,c.patchConfig)(t,{callbacks:a?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(h(n,"output"))),n}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),n=await Promise.all(a.map(c.getCallbackManagerForConfig)),i=await Promise.all(n.map(((t,r)=>t?.handleChainStart(this.toJSON(),h(e[r],"input"),void 0,void 0,void 0,void 0,a[r].runName))));let s=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e];s=await t.batch(s,i.map(((t,r)=>{const n=t?.getChild(`seq:step:${e+1}`);return(0,c.patchConfig)(a[r],{callbacks:n})})),r)}}catch(e){throw await Promise.all(i.map((t=>t?.handleChainError(e)))),e}return await Promise.all(i.map((e=>e?.handleChainEnd(h(s,"output"))))),s}async*_streamIterator(e,t){const r=await(0,c.getCallbackManagerForConfig)(t),a=await(r?.handleChainStart(this.toJSON(),h(e,"input"),void 0,void 0,void 0,void 0,t?.runName)),n=[this.first,...this.middle,this.last];let i,s=!0;try{let r=n[0].transform(async function*(){yield e}(),(0,c.patchConfig)(t,{callbacks:a?.getChild("seq:step:1")}));for(let e=1;e<n.length;e+=1){const i=n[e];r=await i.transform(r,(0,c.patchConfig)(t,{callbacks:a?.getChild(`seq:step:${e+1}`)}))}for await(const e of r)if(yield e,s)if(void 0===i)i=e;else try{i=(0,l.concat)(i,e)}catch(e){i=void 0,s=!1}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(h(i,"output")))}pipe(e){return b.isRunnableSequence(e)?new b({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new b({first:this.first,middle:[...this.middle,this.last],last:w(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&p.isRunnable(e)}static from([e,...t],r){return new b({first:w(e),middle:t.slice(0,-1).map(w),last:w(t[t.length-1]),name:r})}}t.RunnableSequence=b;class y extends p{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=w(r)}static from(e){return new y({steps:e})}async invoke(e,t){const r=await(0,c.getCallbackManagerForConfig)(t),a=await(r?.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,t?.runName)),n={};try{await Promise.all(Object.entries(this.steps).map((async([r,i])=>{n[r]=await i.invoke(e,(0,c.patchConfig)(t,{callbacks:a?.getChild(`map:key:${r}`)}))})))}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(n)),n}async*_transform(e,t,r){const a={...this.steps},n=(0,l.atee)(e,Object.keys(a).length),i=new Map(Object.entries(a).map((([e,a],i)=>{const s=a.transform(n[i],(0,c.patchConfig)(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then((t=>({key:e,gen:s,result:t})))]})));for(;i.size;){const{key:e,result:t,gen:r}=await Promise.race(i.values());i.delete(e),t.done||(yield{[e]:t.value},i.set(e,r.next().then((t=>({key:e,gen:r,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await r.setup,l.IterableReadableStream.fromAsyncGenerator(r)}}t.RunnableMap=y;class _ extends p{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new _({func:e})}async _invoke(e,t,r){let a=await this.func(e,{config:t});if(a&&p.isRunnable(a)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");a=await a.invoke(e,(0,c.patchConfig)(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??c.DEFAULT_RECURSION_LIMIT)-1}))}return a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let a;for await(const t of e)if(void 0===a)a=t;else try{a=(0,l.concat)(a,t)}catch(e){a=t}const n=await this.func(a,{config:r});if(n&&p.isRunnable(n)){if(0===r?.recursionLimit)throw new Error("Recursion limit reached.");const e=await n.stream(a,(0,c.patchConfig)(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??c.DEFAULT_RECURSION_LIMIT)-1}));for await(const t of e)yield t}else yield n}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await r.setup,l.IterableReadableStream.fromAsyncGenerator(r)}}t.RunnableLambda=_,t.RunnableParallel=class extends y{};class v extends p{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await i.CallbackManager.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),a=await(r?.handleChainStart(this.toJSON(),h(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let n;for(const r of this.runnables())try{const n=await r.invoke(e,(0,c.patchConfig)(t,{callbacks:a?.getChild()}));return await(a?.handleChainEnd(h(n,"output"))),n}catch(e){void 0===n&&(n=e)}if(void 0===n)throw new Error("No error stored at end of fallback.");throw await(a?.handleChainError(n)),n}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),n=await Promise.all(a.map((e=>i.CallbackManager.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),s=await Promise.all(n.map(((t,r)=>t?.handleChainStart(this.toJSON(),h(e[r],"input"),void 0,void 0,void 0,void 0,a[r].runName))));let o;for(const t of this.runnables())try{const n=await t.batch(e,s.map(((e,t)=>(0,c.patchConfig)(a[t],{callbacks:e?.getChild()}))),r);return await Promise.all(s.map(((e,t)=>e?.handleChainEnd(h(n[t],"output"))))),n}catch(e){void 0===o&&(o=e)}if(!o)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(s.map((e=>e?.handleChainError(o)))),o}}function w(e){if("function"==typeof e)return new _({func:e});if(p.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[r,a]of Object.entries(e))t[r]=w(a);return new y({steps:t})}}t.RunnableWithFallbacks=v,t._coerceToRunnable=w;class C extends p{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof y&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const a=this.mapper.getStepsKeys(),[n,i]=(0,l.atee)(e),s=this.mapper.transform(i,(0,c.patchConfig)(r,{callbacks:t?.getChild()})),o=s.next();for await(const e of n){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!a.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of s)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await r.setup,l.IterableReadableStream.fromAsyncGenerator(r)}}t.RunnableAssign=C;class O extends p{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await r.setup,l.IterableReadableStream.fromAsyncGenerator(r)}}t.RunnablePick=O},3014:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.patchConfig=t.ensureConfig=t.mergeConfigs=t.getCallbackManagerForConfig=t.DEFAULT_RECURSION_LIMIT=void 0;const a=r(9028);t.DEFAULT_RECURSION_LIMIT=25,t.getCallbackManagerForConfig=async function(e){return a.CallbackManager.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)},t.mergeConfigs=function(...e){const t=i();for(const r of e.filter((e=>!!e)))for(const e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e)t[e]=[...new Set(t[e].concat(r[e]??[]))];else if("configurable"===e)t[e]={...t[e],...r[e]};else if("callbacks"===e){const e=t.callbacks,n=r.callbacks;if(Array.isArray(n))if(e)if(Array.isArray(e))t.callbacks=e.concat(n);else{const r=e.copy();for(const e of n)r.addHandler((0,a.ensureHandler)(e),!0);t.callbacks=r}else t.callbacks=n;else if(n)if(e)if(Array.isArray(e)){const r=n.copy();for(const t of e)r.addHandler((0,a.ensureHandler)(t),!0);t.callbacks=r}else t.callbacks=new a.CallbackManager(n._parentRunId,{handlers:e.handlers.concat(n.handlers),inheritableHandlers:e.inheritableHandlers.concat(n.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(n.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(n.inheritableTags))),metadata:{...e.metadata,...n.metadata}});else t.callbacks=n}else{const a=e;t[a]=r[a]??t[a]}return t};const n=new Set(["string","number","boolean"]);function i(e){let t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25};if(e&&(t={...t,...e}),e?.configurable)for(const r of Object.keys(e.configurable))n.has(typeof e.configurable[r])&&!t.metadata?.[r]&&(t.metadata||(t.metadata={}),t.metadata[r]=e.configurable[r]);return t}t.ensureConfig=i,t.patchConfig=function(e={},{callbacks:t,maxConcurrency:r,recursionLimit:a,runName:n,configurable:s}={}){const o=i(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==a&&(o.recursionLimit=a),void 0!==r&&(o.maxConcurrency=r),void 0!==n&&(o.runName=n),void 0!==s&&(o.configurable={...o.configurable,...s}),o}},6969:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTracer=void 0;const a=r(7986);function n(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class i extends a.BaseCallbackHandler{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=(r=e.start_time,a=e.id,`${new Date(r).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+a);var r,a;const n={...e};if(void 0!==n.parent_run_id){const e=this.runMap.get(n.parent_run_id);e&&(this._addChildRun(e,n),e.child_execution_order=Math.max(e.child_execution_order,n.child_execution_order),n.trace_id=e.trace_id,void 0!==e.dotted_order&&(n.dotted_order=[e.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;this.runMap.set(n.id,n),await(this.onRunCreate?.(n))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,n,i,s,o){const l=this._getExecutionOrder(a),c=Date.now(),u=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:i||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleChatModelStart(e,t,r,a,n,i,s,o){const l=this._getExecutionOrder(a),c=Date.now(),u=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:i||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleLLMEnd(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onLLMEnd?.(r)),await this._endTrace(r),r}async handleLLMError(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onLLMError?.(r)),await this._endTrace(r),r}async handleChainStart(e,t,r,a,n,i,s,o){const l=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(u),await(this.onChainStart?.(u)),u}async handleChainEnd(e,t,r,a,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=n(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=n(i.inputs,"input")),await(this.onChainEnd?.(s)),await this._endTrace(s),s}async handleChainError(e,t,r,a,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=e.message+(e?.stack?`\n\n${e.stack}`:""),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=n(i.inputs,"input")),await(this.onChainError?.(s)),await this._endTrace(s),s}async handleToolStart(e,t,r,a,n,i,s){const o=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(c),await(this.onToolStart?.(c)),c}async handleToolEnd(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onToolEnd?.(r)),await this._endTrace(r),r}async handleToolError(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onToolError?.(r)),await this._endTrace(r),r}async handleAgentAction(e,t){const r=this.runMap.get(t);if(!r||"chain"!==r?.run_type)return;const a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(r))}async handleAgentEnd(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(r)))}async handleRetrieverStart(e,t,r,a,n,i,s){const o=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(c),await(this.onRetrieverStart?.(c)),c}async handleRetrieverEnd(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverEnd?.(r)),await this._endTrace(r),r}async handleRetrieverError(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverError?.(r)),await this._endTrace(r),r}async handleText(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(r)))}async handleLLMNewToken(e,t,r,a,n,i){const s=this.runMap.get(r);if(!s||"llm"!==s?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await(this.onLLMNewToken?.(s,e)),s}}t.BaseTracer=i},156:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleCallbackHandler=void 0;const n=a(r(6434)),i=r(6969);function s(e,t){return`${e.open}${t}${e.close}`}function o(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function l(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:c}=n.default;class u extends i.BaseTracer{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const e=this.runMap.get(r.parent_run_id);if(!e)break;t.push(e),r=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,r)=>{const a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?s(n.default.bold,a):a})).join(" > ");return s(c.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.green,"[chain/start]")} [${t}] Entering Chain run with input: ${o(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[chain/end]")} [${t}] [${l(e)}] Exiting Chain run with output: ${o(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[chain/error]")} [${t}] [${l(e)}] Chain run errored with error: ${o(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${s(c.green,"[llm/start]")} [${t}] Entering LLM run with input: ${o(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[llm/end]")} [${t}] [${l(e)}] Exiting LLM run with output: ${o(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[llm/error]")} [${t}] [${l(e)}] LLM run errored with error: ${o(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[tool/end]")} [${t}] [${l(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[tool/error]")} [${t}] [${l(e)}] Tool run errored with error: ${o(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${o(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.cyan,"[retriever/end]")} [${t}] [${l(e)}] Exiting Retriever run with output: ${o(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${s(c.red,"[retriever/error]")} [${t}] [${l(e)}] Retriever run errored with error: ${o(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${s(c.blue,"[agent/action]")} [${r}] Agent selected action: ${o(t.actions[t.actions.length-1],"[action]")}`)}}t.ConsoleCallbackHandler=u},6614:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTracingV2CallbackHandler=t.getTracingCallbackHandler=void 0;const a=r(1744),n=r(7530);t.getTracingCallbackHandler=async function(e){const t=new n.LangChainTracerV1;return e?await t.loadSession(e):await t.loadDefaultSession(),t},t.getTracingV2CallbackHandler=async function(){return new a.LangChainTracer}},1242:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogStreamCallbackHandler=t.RunLog=t.RunLogPatch=void 0;const a=r(9401),n=r(6969),i=r(8197);class s{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){const t=this.ops.concat(e.ops),r=(0,a.applyPatch)({},t);return new o({ops:t,state:r[r.length-1].newDocument})}}t.RunLogPatch=s;class o extends s{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=(0,a.applyPatch)(this.state,e.ops);return new o({ops:t,state:r[r.length-1].newDocument})}}t.RunLog=o;class l extends n.BaseTracer{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=i.IterableReadableStream.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every((e=>!this.excludeTags?.includes(e)))),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new s({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new s({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new s({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const r=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const a=new s({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){const t=new s({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){const r=this.keyMapByRunId[e.id];if(void 0===r)return;const a=new s({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t}]});await this.writer.write(a)}}t.LogStreamCallbackHandler=l},4313:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootListenersTracer=void 0;const a=r(6969);class n extends a.BaseTracer{constructor({config:e,onStart:t,onEnd:r,onError:a}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}t.RootListenersTracer=n},1744:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LangChainTracer=void 0;const a=r(4547),n=r(1073),i=r(6969);class s extends i.BaseTracer{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:i}=e;this.projectName=r??(0,n.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,n.getEnvironmentVariable)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??new a.Client({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await(0,n.getRuntimeEnvironment)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}t.LangChainTracer=s},7530:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LangChainTracerV1=void 0;const a=r(1165),n=r(1073),i=r(6969);class s extends i.BaseTracer{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=(0,n.getEnvironmentVariable)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){const t=this.session??await this.loadDefaultSession(),r=e.serialized;let n;if("llm"===e.run_type){const i=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map((e=>(0,a.getBufferString)(e)));n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:i,response:e.outputs}}else if("chain"===e.run_type){const a=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:a.filter((e=>"llm"===e.type)),child_chain_runs:a.filter((e=>"chain"===e.type)),child_tool_runs:a.filter((e=>"tool"===e.type))}}else{if("tool"!==e.run_type)throw new Error(`Unknown run type: ${e.run_type}`);{const a=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));n={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(r),child_llm_runs:a.filter((e=>"llm"===e.type)),child_chain_runs:a.filter((e=>"chain"===e.type)),child_tool_runs:a.filter((e=>"tool"===e.type))}}}return n}async persistRun(e){let t,r;r=void 0!==e.run_type?await this.convertV2RunToRun(e):e,t="llm"===r.type?`${this.endpoint}/llm-runs`:"chain"===r.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;const a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const a=await t.json();return 0===a.length?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=a,this.session=r,r)}}t.LangChainTracerV1=s},8541:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCaller=void 0;const n=a(r(2693)),i=a(r(5860)),s=[400,401,402,403,404,405,406,407,408,409],o=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&s.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};t.AsyncCaller=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??o;const t="default"in i.default?i.default.default:i.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>(0,n.default)((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},1073:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironmentVariable=t.getRuntimeEnvironment=t.getEnv=t.isNode=t.isDeno=t.isJsDom=t.isWebWorker=t.isBrowser=void 0,t.isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,t.isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,t.isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),t.isDeno=()=>"undefined"!=typeof Deno,t.isNode=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!(0,t.isDeno)(),t.getEnv=()=>{let e;return e=(0,t.isBrowser)()?"browser":(0,t.isNode)()?"node":(0,t.isWebWorker)()?"webworker":(0,t.isJsDom)()?"jsdom":(0,t.isDeno)()?"deno":"other",e},t.getRuntimeEnvironment=async function(){if(void 0===r){const e=(0,t.getEnv)();r={library:"langchain-js",runtime:e}}return r},t.getEnvironmentVariable=function(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}},9401:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.unescapePathComponent=t.escapePathComponent=t.deepClone=t.JsonPatchError=void 0,i(r(2851),t),i(r(8421),t);var o=r(2312);Object.defineProperty(t,"JsonPatchError",{enumerable:!0,get:function(){return o.PatchError}}),Object.defineProperty(t,"deepClone",{enumerable:!0,get:function(){return o._deepClone}}),Object.defineProperty(t,"escapePathComponent",{enumerable:!0,get:function(){return o.escapePathComponent}}),Object.defineProperty(t,"unescapePathComponent",{enumerable:!0,get:function(){return o.unescapePathComponent}});const l=s(r(2851)),c=r(2312);t.default={...l,JsonPatchError:c.PatchError,deepClone:c._deepClone,escapePathComponent:c.escapePathComponent,unescapePathComponent:c.unescapePathComponent}},2851:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._areEquals=t.validate=t.validator=t.applyReducer=t.applyPatch=t.applyOperation=t.getValueByPointer=t.deepClone=t.JsonPatchError=void 0;const a=r(2312);t.JsonPatchError=a.PatchError,t.deepClone=a._deepClone;const n={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let n=s(r,this.path);n&&(n=(0,a._deepClone)(n));const i=o(r,{op:"remove",path:this.from}).removed;return o(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(e,t,r){const n=s(r,this.from);return o(r,{op:"add",path:this.path,value:(0,a._deepClone)(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:d(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var i={add:function(e,t,r){return(0,a.isInteger)(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:n.move,copy:n.copy,test:n.test,_get:n._get};function s(e,t){if(""==t)return e;var r={op:"_get",path:t};return o(e,r),r.value}function o(e,r,o=!1,l=!0,u=!0,h=0){if(o&&("function"==typeof o?o(r,0,e,r.path):c(r,0)),""===r.path){let a={newDocument:e};if("add"===r.op)return a.newDocument=r.value,a;if("replace"===r.op)return a.newDocument=r.value,a.removed=e,a;if("move"===r.op||"copy"===r.op)return a.newDocument=s(e,r.from),"move"===r.op&&(a.removed=e),a;if("test"===r.op){if(a.test=d(e,r.value),!1===a.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,r,e);return a.newDocument=e,a}if("remove"===r.op)return a.removed=e,a.newDocument=null,a;if("_get"===r.op)return r.value=e,a;if(o)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",h,r,e);return a}{l||(e=(0,a._deepClone)(e));const s=(r.path||"").split("/");let d,p,f,m=e,g=1,b=s.length;for(f="function"==typeof o?o:c;;){if(p=s[g],p&&-1!=p.indexOf("~")&&(p=(0,a.unescapePathComponent)(p)),u&&("__proto__"==p||"prototype"==p&&g>0&&"constructor"==s[g-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(o&&void 0===d&&(void 0===m[p]?d=s.slice(0,g).join("/"):g==b-1&&(d=r.path),void 0!==d&&f(r,0,e,d)),g++,Array.isArray(m)){if("-"===p)p=m.length;else{if(o&&!(0,a.isInteger)(p))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",h,r,e);(0,a.isInteger)(p)&&(p=~~p)}if(g>=b){if(o&&"add"===r.op&&p>m.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",h,r,e);const a=i[r.op].call(r,m,p,e);if(!1===a.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,r,e);return a}}else if(g>=b){const a=n[r.op].call(r,m,p,e);if(!1===a.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,r,e);return a}if(m=m[p],o&&g<b&&(!m||"object"!=typeof m))throw new t.JsonPatchError("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",h,r,e)}}}function l(e,r,n,i=!0,s=!0){if(n&&!Array.isArray(r))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=(0,a._deepClone)(e));const l=new Array(r.length);for(let t=0,a=r.length;t<a;t++)l[t]=o(e,r[t],n,!0,s,t),e=l[t].newDocument;return l.newDocument=e,l}function c(e,r,i,s){if("object"!=typeof e||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",r,e,i);if(!n[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",r,e,i);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",r,e,i);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",r,e,i);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",r,e,i);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",r,e,i);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&(0,a.hasUndefined)(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",r,e,i);if(i)if("add"==e.op){var o=e.path.split("/").length,l=s.split("/").length;if(o!==l+1&&o!==l)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",r,e,i)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==s)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",r,e,i)}else if("move"===e.op||"copy"===e.op){var c=u([{op:"_get",path:e.from,value:void 0}],i);if(c&&"OPERATION_PATH_UNRESOLVABLE"===c.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",r,e,i)}}function u(e,r,n){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(r)l((0,a._deepClone)(r),(0,a._deepClone)(e),n||!0);else{n=n||c;for(var i=0;i<e.length;i++)n(e[i],i,r,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}function d(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,n,i=Array.isArray(e),s=Array.isArray(t);if(i&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!d(e[r],t[r]))return!1;return!0}if(i!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!d(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}t.getValueByPointer=s,t.applyOperation=o,t.applyPatch=l,t.applyReducer=function(e,r,a){const n=o(e,r);if(!1===n.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",a,r,e);return n.newDocument},t.validator=c,t.validate=u,t._areEquals=d},8421:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compare=t.generate=t.observe=t.unobserve=void 0;const a=r(2312),n=r(2851);var i=new WeakMap;class s{constructor(e){Object.defineProperty(this,"obj",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.obj=e}}class o{constructor(e,t){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=e,this.observer=t}}function l(e,t=!1){var r=i.get(e.object);c(r.value,e.object,e.patches,"",t),e.patches.length&&(0,n.applyPatch)(r.value,e.patches);var a=e.patches;return a.length>0&&(e.patches=[],e.callback&&e.callback(a)),a}function c(e,t,r,n,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=(0,a._objectKeys)(t),o=(0,a._objectKeys)(e),l=!1,u=o.length-1;u>=0;u--){var d=e[p=o[u]];if(!(0,a.hasOwnProperty)(t,p)||void 0===t[p]&&void 0!==d&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&r.push({op:"test",path:n+"/"+(0,a.escapePathComponent)(p),value:(0,a._deepClone)(d)}),r.push({op:"remove",path:n+"/"+(0,a.escapePathComponent)(p)}),l=!0):(i&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}));else{var h=t[p];"object"==typeof d&&null!=d&&"object"==typeof h&&null!=h&&Array.isArray(d)===Array.isArray(h)?c(d,h,r,n+"/"+(0,a.escapePathComponent)(p),i):d!==h&&(i&&r.push({op:"test",path:n+"/"+(0,a.escapePathComponent)(p),value:(0,a._deepClone)(d)}),r.push({op:"replace",path:n+"/"+(0,a.escapePathComponent)(p),value:(0,a._deepClone)(h)}))}}if(l||s.length!=o.length)for(u=0;u<s.length;u++){var p=s[u];(0,a.hasOwnProperty)(e,p)||void 0===t[p]||r.push({op:"add",path:n+"/"+(0,a.escapePathComponent)(p),value:(0,a._deepClone)(t[p])})}}}t.unobserve=function(e,t){t.unobserve()},t.observe=function(e,t){var r,n=function(e){return i.get(e)}(e);if(n){const e=function(e,t){return e.observers.get(t)}(n,t);r=e&&e.observer}else n=new s(e),i.set(e,n);if(r)return r;if(r={},n.value=(0,a._deepClone)(e),t){r.callback=t,r.next=null;var c=()=>{l(r)},u=()=>{clearTimeout(r.next),r.next=setTimeout(c)};"undefined"!=typeof window&&(window.addEventListener("mouseup",u),window.addEventListener("keyup",u),window.addEventListener("mousedown",u),window.addEventListener("keydown",u),window.addEventListener("change",u))}return r.patches=[],r.object=e,r.unobserve=()=>{l(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(n,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",u),window.removeEventListener("keyup",u),window.removeEventListener("mousedown",u),window.removeEventListener("keydown",u),window.removeEventListener("change",u))},n.observers.set(t,new o(t,r)),r},t.generate=l,t.compare=function(e,t,r=!1){var a=[];return c(e,t,a,"",r),a}},2312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatchError=t.hasUndefined=t.getPath=t._getPathRecursive=t.unescapePathComponent=t.escapePathComponent=t.isInteger=t._deepClone=t._objectKeys=t.hasOwnProperty=void 0;const r=Object.prototype.hasOwnProperty;function a(e,t){return r.call(e,t)}function n(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)a(e,r)&&t.push(r);return t}function i(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function s(e,t){let r;for(let n in e)if(a(e,n)){if(e[n]===t)return i(n)+"/";if("object"==typeof e[n]&&(r=s(e[n],t),""!=r))return i(n)+"/"+r}return""}function o(e,t){const r=[e];for(const e in t){const a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}t.hasOwnProperty=a,t._objectKeys=n,t._deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},t.isInteger=function(e){let t=0;const r=e.length;let a;for(;t<r;){if(a=e.charCodeAt(t),!(a>=48&&a<=57))return!1;t++}return!0},t.escapePathComponent=i,t.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},t._getPathRecursive=s,t.getPath=function(e,t){if(e===t)return"/";const r=s(e,t);if(""===r)throw new Error("Object not found in root");return`/${r}`},t.hasUndefined=function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(e(t[r]))return!0}else if("object"==typeof t){const a=n(t),i=a.length;for(var r=0;r<i;r++)if(e(t[a[r]]))return!0}return!1};class l extends Error{constructor(e,t,r,a,n){super(o(e,{name:t,index:r,operation:a,tree:n})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.setPrototypeOf(this,new.target.prototype),this.message=o(e,{name:t,index:r,operation:a,tree:n})}}t.PatchError=l},4116:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.insecureHash=void 0;var a=r(749);Object.defineProperty(t,"insecureHash",{enumerable:!0,get:function(){return a.insecureHash}})},749:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.insecureHash=void 0;var r="object"==typeof window?window:{},a="0123456789abcdef".split(""),n=[-2147483648,8388608,32768,128],i=[24,16,8,0],s=[];function o(e){e?(s[0]=s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0,this.blocks=s):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}o.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===r.ArrayBuffer&&(e=new Uint8Array(e));for(var a,n,s=0,o=e.length||0,l=this.blocks;s<o;){if(this.hashed&&(this.hashed=!1,l[0]=this.block,l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),t)for(n=this.start;s<o&&n<64;++s)l[n>>2]|=e[s]<<i[3&n++];else for(n=this.start;s<o&&n<64;++s)(a=e.charCodeAt(s))<128?l[n>>2]|=a<<i[3&n++]:a<2048?(l[n>>2]|=(192|a>>6)<<i[3&n++],l[n>>2]|=(128|63&a)<<i[3&n++]):a<55296||a>=57344?(l[n>>2]|=(224|a>>12)<<i[3&n++],l[n>>2]|=(128|a>>6&63)<<i[3&n++],l[n>>2]|=(128|63&a)<<i[3&n++]):(a=65536+((1023&a)<<10|1023&e.charCodeAt(++s)),l[n>>2]|=(240|a>>18)<<i[3&n++],l[n>>2]|=(128|a>>12&63)<<i[3&n++],l[n>>2]|=(128|a>>6&63)<<i[3&n++],l[n>>2]|=(128|63&a)<<i[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=l[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},o.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=n[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},o.prototype.hash=function(){var e,t,r=this.h0,a=this.h1,n=this.h2,i=this.h3,s=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a&n|~a&i)+s+1518500249+o[e]<<0)<<5|s>>>27)+(r&(a=a<<30|a>>>2)|~r&n)+i+1518500249+o[e+1]<<0)<<5|i>>>27)+(s&(r=r<<30|r>>>2)|~s&a)+n+1518500249+o[e+2]<<0)<<5|n>>>27)+(i&(s=s<<30|s>>>2)|~i&r)+a+1518500249+o[e+3]<<0)<<5|a>>>27)+(n&(i=i<<30|i>>>2)|~n&s)+r+1518500249+o[e+4]<<0,n=n<<30|n>>>2;for(;e<40;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a^n^i)+s+1859775393+o[e]<<0)<<5|s>>>27)+(r^(a=a<<30|a>>>2)^n)+i+1859775393+o[e+1]<<0)<<5|i>>>27)+(s^(r=r<<30|r>>>2)^a)+n+1859775393+o[e+2]<<0)<<5|n>>>27)+(i^(s=s<<30|s>>>2)^r)+a+1859775393+o[e+3]<<0)<<5|a>>>27)+(n^(i=i<<30|i>>>2)^s)+r+1859775393+o[e+4]<<0,n=n<<30|n>>>2;for(;e<60;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a&n|a&i|n&i)+s-1894007588+o[e]<<0)<<5|s>>>27)+(r&(a=a<<30|a>>>2)|r&n|a&n)+i-1894007588+o[e+1]<<0)<<5|i>>>27)+(s&(r=r<<30|r>>>2)|s&a|r&a)+n-1894007588+o[e+2]<<0)<<5|n>>>27)+(i&(s=s<<30|s>>>2)|i&r|s&r)+a-1894007588+o[e+3]<<0)<<5|a>>>27)+(n&(i=i<<30|i>>>2)|n&s|i&s)+r-1894007588+o[e+4]<<0,n=n<<30|n>>>2;for(;e<80;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a^n^i)+s-899497514+o[e]<<0)<<5|s>>>27)+(r^(a=a<<30|a>>>2)^n)+i-899497514+o[e+1]<<0)<<5|i>>>27)+(s^(r=r<<30|r>>>2)^a)+n-899497514+o[e+2]<<0)<<5|n>>>27)+(i^(s=s<<30|s>>>2)^r)+a-899497514+o[e+3]<<0)<<5|a>>>27)+(n^(i=i<<30|i>>>2)^s)+r-899497514+o[e+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+a<<0,this.h2=this.h2+n<<0,this.h3=this.h3+i<<0,this.h4=this.h4+s<<0},o.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,i=this.h4;return a[e>>28&15]+a[e>>24&15]+a[e>>20&15]+a[e>>16&15]+a[e>>12&15]+a[e>>8&15]+a[e>>4&15]+a[15&e]+a[t>>28&15]+a[t>>24&15]+a[t>>20&15]+a[t>>16&15]+a[t>>12&15]+a[t>>8&15]+a[t>>4&15]+a[15&t]+a[r>>28&15]+a[r>>24&15]+a[r>>20&15]+a[r>>16&15]+a[r>>12&15]+a[r>>8&15]+a[r>>4&15]+a[15&r]+a[n>>28&15]+a[n>>24&15]+a[n>>20&15]+a[n>>16&15]+a[n>>12&15]+a[n>>8&15]+a[n>>4&15]+a[15&n]+a[i>>28&15]+a[i>>24&15]+a[i>>20&15]+a[i>>16&15]+a[i>>12&15]+a[i>>8&15]+a[i>>4&15]+a[15&i]},o.prototype.toString=o.prototype.hex,o.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,n>>24&255,n>>16&255,n>>8&255,255&n]},o.prototype.array=o.prototype.digest,o.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e},t.insecureHash=e=>new o(!0).update(e).hex()},8197:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pipeGeneratorWithSetup=t.AsyncGeneratorWithSetup=t.concat=t.atee=t.IterableReadableStream=void 0;class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new r({start:e=>function r(){return t.read().then((({done:t,value:a})=>{if(!t)return e.enqueue(a),r();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){const{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)}})}}t.IterableReadableStream=r,t.atee=function(e,t=2){const r=Array.from({length:t},(()=>[]));return r.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))},t.concat=function e(t,r){if(Array.isArray(t)&&Array.isArray(r))return t.concat(r);if("string"==typeof t&&"string"==typeof r)return t+r;if("number"==typeof t&&"number"==typeof r)return t+r;if("concat"in t&&"function"==typeof t.concat)return t.concat(r);if("object"==typeof t&&"object"==typeof r){const a={...t};for(const[t,n]of Object.entries(r))a[t]=t in a?e(a[t],n):n;return a}throw new Error(`Cannot concat ${typeof t} and ${typeof r}`)};class a{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((r,a)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(r,a):this.firstResult.then((e=>r(void 0)),a)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}t.AsyncGeneratorWithSetup=a,t.pipeGeneratorWithSetup=async function(e,t,r,...n){const i=new a(t,r),s=await i.setup;return{output:e(i,s,...n),setup:s}}},3022:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodingForModel=t.getEncoding=void 0;const a=r(7121),n=r(8541),i={},s=new n.AsyncCaller({});async function o(e){return e in i||(i[e]=s.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new a.Tiktoken(e))).catch((t=>{throw delete i[e],t}))),await i[e]}t.getEncoding=o,t.encodingForModel=async function(e){return o((0,a.getEncodingNameForModel)(e))}},114:(e,t,r)=>{e.exports=r(6709)},9693:(e,t,r)=>{e.exports=r(1165)},3174:(e,t,r)=>{e.exports=r(2861)},2561:(e,t,r)=>{e.exports=r(8197)},7121:(e,t,r)=>{"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=a(r(9742)),i=Object.defineProperty;function s(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let r=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;r.length>1;){let a=null;for(let n=0;n<r.length-1;n++){const i=e.slice(r[n].start,r[n+1].end),s=t.get(i.join(","));null!=s&&(null==a||s<a[0])&&(a=[s,n])}if(null==a)break;{const e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}}return r}(e,t).map((r=>t.get(e.slice(r.start,r.end).join(",")))).filter((e=>null!=e))}var o,l=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const r=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[r,a,...n]=t.split(" "),i=Number.parseInt(a,10);return n.forEach(((t,r)=>e[t]=i+r)),e}),{});for(const[e,t]of Object.entries(r)){const r=n.default.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],r="all"){const a=new RegExp(this.patStr,"ug"),n=l.specialTokenRegex(Object.keys(this.specialTokens)),i=[],o=new Set("all"===t?Object.keys(this.specialTokens):t),c=new Set("all"===r?Object.keys(this.specialTokens).filter((e=>!o.has(e))):r);if(c.size>0){const t=l.specialTokenRegex([...c]),r=e.match(t);if(null!=r)throw new Error(`The text contains a special token that is not allowed: ${r[0]}`)}let u=0;for(;;){let t=null,r=u;for(;n.lastIndex=r,t=n.exec(e),null!=t&&!o.has(t[0]);)r=t.index+1;const l=t?.index??e.length;for(const t of e.substring(u,l).matchAll(a)){const e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));null==r?i.push(...s(e,this.rankMap)):i.push(r)}if(null==t)break;let c=this.specialTokens[t[0]];i.push(c),u=t.index+t[0].length}return i}decode(e){const t=[];let r=0;for(let a=0;a<e.length;++a){const n=e[a],i=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=i&&(t.push(i),r+=i.length)}const a=new Uint8Array(r);let n=0;for(const e of t)a.set(e,n),n+=e.length;return this.textDecoder.decode(a)}},c=l;((e,t,r)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(c,"symbol"!=typeof(o="specialTokenRegex")?o+"":o,(e=>new RegExp(e.map((e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"))).join("|"),"g"))),t.Tiktoken=c,t.getEncodingNameForModel=function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}},8192:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const s=i(r(7429)),o=r(2166),l=r(6974),c=r(2209),u=r(2034),d=e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},h=async(e,t)=>{const r=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};function p(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function f(e){return"true"===(0,c.getEnvironmentVariable)("LANGCHAIN_HIDE_INPUTS")?{}:e}function m(e){return"true"===(0,c.getEnvironmentVariable)("LANGCHAIN_HIDE_OUTPUTS")?{}:e}function g(e){if(!s.validate(e))throw new Error(`Invalid UUID: ${e}`)}class b{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null});const t=b.getDefaultClientConfig();this.apiUrl=p(e.apiUrl??t.apiUrl)??"",this.apiKey=p(e.apiKey??t.apiKey),this.webUrl=p(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??12e3,this.caller=new o.AsyncCaller(e.callerOptions??{})}static getDefaultClientConfig(){const e=(0,c.getEnvironmentVariable)("LANGCHAIN_API_KEY");return{apiUrl:(0,c.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0}}validateApiKeyIfHosted(){if(!d(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:d(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={"User-Agent":`langsmith-js/${u.__version__}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _getResponse(e,t){const r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,n=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);return n}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));const n=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);const s=await i.json();if(0===s.length)break;if(yield s,s.length<a)break;r+=s.length}}async*_getCursorPaginatedList(e,t=null,r="POST",a="runs"){const n=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(n)}),i=await t.json();if(!i)break;if(!i[a])break;yield i[a];const s=i.cursors;if(!s)break;if(!s.next)break;n.cursor=s.next}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},a=r.metadata,n=await(0,c.getRuntimeEnvironment)(),i=(0,c.getLangChainEnvVarsMetadata)(),s=e.project_name;delete e.project_name;const o={session_name:s,...e,extra:{...e.extra,runtime:{...n,...r.runtime},metadata:{...i,...i.revision_id||e.revision_id?{revision_id:e.revision_id??i.revision_id}:{},...a}}};o.inputs=f(o.inputs),o.outputs&&(o.outputs=m(o.outputs));const l=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)});await h(l,"create run")}async updateRun(e,t){g(e),t.inputs&&(t.inputs=f(t.inputs)),t.outputs&&(t.outputs=m(t.outputs));const r={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await h(a,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){g(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,c.getEnvironmentVariable)("LANGCHAIN_PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(this.listRuns({id:e.child_run_ids})),r={},a={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),a[e.id]=e}e.child_runs=r[e.id]||[];for(const t in r)t!==e.id&&(a[t].child_runs=r[t]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:a,startTime:n,executionOrder:i,runType:s,error:o,id:l,query:c,filter:u,limit:d}){let h=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");h=(await this.readProject({projectName:t})).id}const p={session:h?[h]:null,run_type:s,reference_example:a,query:c,filter:u,execution_order:i,parent_run:r?[r]:null,start_time:n?n.toISOString():null,error:o,id:l,limit:d};for await(const e of this._getCursorPaginatedList("/runs/query",p))yield*e}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||s.v4()};g(e);const a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),n=await a.json();if(null===n||!("share_token"in n))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${n.share_token}/r`}async unshareRun(e){g(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await h(t,"unshare run")}async readRunSharedLink(e){g(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)r.append("id",e);g(e);const a=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await a.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),g(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};g(e);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),n=await a.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){g(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await h(t,"unshare dataset")}async readSharedDataset(e){g(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await t.json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:n=null,referenceDatasetId:i=null}){const s=a?"?upsert=true":"",o=`${this.apiUrl}/sessions${s}`,l=n||{};r&&(l.metadata=r);const c={name:e,extra:l,description:t};null!==i&&(c.reference_dataset_id=i);const u=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)}),d=await u.json();if(!u.ok)throw new Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return d}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:n=null,endTime:i=null}){const s=`${this.apiUrl}/sessions/${e}`;let o=n;a&&(o={...o||{},metadata:a});const l={name:t,extra:o,description:r,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(fetch,s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),u=await c.json();if(!c.ok)throw new Error(`Failed to update project ${e}: ${c.status} ${c.statusText}`);return u}async readProject({projectId:e,projectName:t}){let r="/sessions";const a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)g(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");a.append("name",t)}const n=await this._get(r,a);let i;if(Array.isArray(n)){if(0===n.length)throw new Error(`Project[id=${e}, name=${t}] not found`);i=n[0]}else i=n;return i}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:n,referenceFree:i}={}){const s=new URLSearchParams;if(void 0!==e)for(const t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==r&&s.append("name_contains",r),void 0!==a)s.append("reference_dataset",a);else if(void 0!==n){const e=await this.readDataset({datasetName:n});s.append("reference_dataset",e.id)}void 0!==i&&s.append("reference_free",i.toString());for await(const e of this._getPaginated("/sessions",s))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e,g(r);const a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await h(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:n,dataType:i,name:s}){const o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach((e=>{l.append("input_keys",e)})),a.forEach((e=>{l.append("output_keys",e)})),n&&l.append("description",n),i&&l.append("data_type",i),s&&l.append("name",s);const c=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok){const e=await c.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:t,dataType:r}={}){const a={name:e,description:t};r&&(a.data_type=r);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok){const t=await n.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${n.status} ${n.statusText}`)}return await n.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const a=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)g(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");a.append("name",t)}const n=await this._get(r,a);let i;if(Array.isArray(n)){if(0===n.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=n[0]}else i=n;return i}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:n}={}){const i=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(const e of r)i.append("id",e);void 0!==a&&i.append("name",a),void 0!==n&&i.append("name_contains",n);for await(const e of this._getPaginated("/datasets",i))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(a=(await this.readDataset({datasetName:t})).id),void 0===a)throw new Error("Must provide datasetName or datasetId");g(a),r+=`/${a}`;const n=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to delete ${r}: ${n.status} ${n.statusText}`);await n.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:n,exampleId:i}){let s=r;if(void 0===s&&void 0===a)throw new Error("Must provide either datasetName or datasetId");if(void 0!==s&&void 0!==a)throw new Error("Must provide either datasetName or datasetId, not both");void 0===s&&(s=(await this.readDataset({datasetName:a})).id);const o=n||new Date,l={dataset_id:s,inputs:e,outputs:t,created_at:o?.toISOString(),id:i},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async createExamples(e){const{inputs:t,outputs:r,sourceRunIds:a,exampleIds:n,datasetId:i,datasetName:s}=e;let o=i;if(void 0===o&&void 0===s)throw new Error("Must provide either datasetName or datasetId");if(void 0!==o&&void 0!==s)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===o){const e=await this.readDataset({datasetName:s});o=e.id}const l=t.map(((e,t)=>({dataset_id:o,inputs:e,outputs:r?r[t]:void 0,id:n?n[t]:void 0,source_run_id:a?a[t]:void 0}))),c=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create examples: ${c.status} ${c.statusText}`);return await c.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const a=e.map((e=>(0,l.isLangChainMessage)(e)?(0,l.convertLangChainMessageToExample)(e):e)),n=(0,l.isLangChainMessage)(t)?(0,l.convertLangChainMessageToExample)(t):t;return this.createExample({input:a},{output:n},r)}async readExample(e){g(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)a=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");a=(await this.readDataset({datasetName:t})).id}const n=new URLSearchParams({dataset:a});if(void 0!==r)for(const e of r)n.append("id",e);for await(const e of this._getPaginated("/examples",n))yield*e}async deleteExample(e){g(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){g(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:n}={loadChildRuns:!1}){let i;if("string"==typeof e)i=await this.readRun(e,{loadChildRuns:a});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);i=e}null!==i.reference_example_id&&void 0!==i.reference_example_id&&(n=await this.readExample(i.reference_example_id));const s=await t.evaluateRun(i,n);let o=r??{};s.evaluatorInfo&&(o={...o,...s.evaluatorInfo});const l=s.targetRunId??i.id;return await this.createFeedback(l,s.key,{score:s?.score,value:s?.value,comment:s?.comment,correction:s?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:s?.sourceRunId})}async createFeedback(e,t,{score:r,value:a,correction:n,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,eager:d=!1}){const p={type:l??"api",metadata:o??{}};void 0===c||void 0===p?.metadata||p.metadata.__run||(p.metadata.__run={run_id:c}),void 0!==p?.metadata&&void 0!==p.metadata.__run?.run_id&&g(p.metadata.__run.run_id);const f={id:u??s.v4(),run_id:e,key:t,score:r,value:a,correction:n,comment:i,feedback_source:p},m=`${this.apiUrl}/feedback`+(d?"/eager":""),b=await this.caller.call(fetch,m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)});return await h(b,"create feedback"),f}async updateFeedback(e,{score:t,value:r,correction:a,comment:n}){const i={};null!=t&&(i.score=t),null!=r&&(i.value=r),null!=a&&(i.correction=a),null!=n&&(i.comment=n),g(e);const s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await h(s,"update feedback")}async readFeedback(e){g(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){g(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const e of t)a.append("key",e);if(r)for(const e of r)a.append("source",e);for await(const e of this._getPaginated("/feedback",a))yield*e}}t.Client=b},2034:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.__version__=t.RunTree=t.Client=void 0;var a=r(8192);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return a.Client}});var n=r(930);Object.defineProperty(t,"RunTree",{enumerable:!0,get:function(){return n.RunTree}}),t.__version__="0.0.63"},930:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RunTree=void 0;const s=i(r(7429)),o=r(2209),l=r(8192),c={};class u{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=u.getDefaultConfig();Object.assign(this,{...t,...e})}static getDefaultConfig(){return{id:s.v4(),project_name:(0,o.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,o.getEnvironmentVariable)("LANGCHAIN_SESSION")??"default",child_runs:[],execution_order:1,child_execution_order:1,api_url:(0,o.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,o.getEnvironmentVariable)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{},client:new l.Client({})}}async createChild(e){const t=new u({...e,parent_run:this,project_name:this.project_name,client:this.client,execution_order:this.child_execution_order+1,child_execution_order:this.child_execution_order+1});return this.child_runs.push(t),t}async end(e,t,r=Date.now()){this.outputs=e,this.error=t,this.end_time=r,this.parent_run&&(this.parent_run.child_execution_order=Math.max(this.parent_run.child_execution_order,this.child_execution_order))}async _convertToCreate(e,t=!0){const r=e.extra??{};r.runtime||(r.runtime={});const a=await(0,o.getRuntimeEnvironment)();for(const[e,t]of Object.entries(a))r.runtime[e]||(r.runtime[e]=t);let n,i;return t?(i=e.parent_run?.id,n=[]):(n=await Promise.all(e.child_runs.map((e=>this._convertToCreate(e,t)))),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:r,execution_order:e.execution_order,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:n,parent_run_id:i}}async postRun(e=!0){const t=await this._convertToCreate(this,!0);if(await this.client.createRun(t),!e){c[r="Posting with excludeChildRuns=false is deprecated and will be removed in a future version."]||(console.warn(r),c[r]=!0);for(const e of this.child_runs)await e.postRun(!1)}var r}async patchRun(){const e={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events};await this.client.updateRun(this.id,e)}}t.RunTree=u},2166:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCaller=void 0;const n=a(r(2693)),i=a(r(5860)),s=[400,401,403,404,405,406,407,408,409];t.AsyncCaller=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in i.default?i.default.default:i.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>(0,n.default)((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&s.includes(+t))throw e},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},2209:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShas=t.setEnvironmentVariable=t.getEnvironmentVariable=t.getEnvironmentVariables=t.getLangChainEnvVarsMetadata=t.getLangChainEnvVars=t.getRuntimeEnvironment=t.getEnv=t.isNode=t.isDeno=t.isJsDom=t.isWebWorker=t.isBrowser=void 0;const a=r(2034);let n,i,s;function o(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,r])=>(e[t]=String(r),e)),{}):void 0}catch(e){return}}function l(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function c(){if(void 0!==s)return s;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const r of e){const e=l(r);void 0!==e&&(t[r]=e)}return s=t,t}t.isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,t.isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,t.isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),t.isDeno=()=>"undefined"!=typeof Deno,t.isNode=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!(0,t.isDeno)(),t.getEnv=()=>n||(n=(0,t.isBrowser)()?"browser":(0,t.isNode)()?"node":(0,t.isWebWorker)()?"webworker":(0,t.isJsDom)()?"jsdom":(0,t.isDeno)()?"deno":"other",n),t.getRuntimeEnvironment=async function(){if(void 0===i){const e=(0,t.getEnv)(),r=c();i={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:a.__version__,...r}}return i},t.getLangChainEnvVars=function(){const e=o()||{},t={};for(const[r,a]of Object.entries(e))r.startsWith("LANGCHAIN_")&&"string"==typeof a&&(t[r]=a);for(const e in t)if((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&"string"==typeof t[e]){const r=t[e];t[e]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2)}return t},t.getLangChainEnvVarsMetadata=function(){const e=o()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[a,n]of Object.entries(e))!a.startsWith("LANGCHAIN_")||"string"!=typeof n||r.includes(a)||a.toLowerCase().includes("key")||a.toLowerCase().includes("secret")||a.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===a?t.revision_id=n:t[a]=n);return t},t.getEnvironmentVariables=o,t.getEnvironmentVariable=l,t.setEnvironmentVariable=function(e,t){"undefined"!=typeof process&&(process.env[e]=t)},t.getShas=c},6974:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertLangChainMessageToExample=t.isLangChainMessage=void 0,t.isLangChainMessage=function(e){return"function"==typeof e?._getType},t.convertLangChainMessageToExample=function(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}},4547:(e,t,r)=>{e.exports=r(2034)}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{const e=r(4951).ChatOllama;window.sendMessage=async function(){var e=document.getElementById("message"),r=e.value;e.value="";var a=document.getElementById("chat-history"),n=document.createElement("div");n.textContent="You: "+r,a.appendChild(n);var i=document.createElement("div");const s=await async function(e){const r=await t.invoke(e);return console.log(r.content),r.content}(r);i.textContent="Agent: "+s,a.appendChild(i)};const t=new e({baseUrl:"http://localhost:11434",model:"nous-hermes"})})()})();